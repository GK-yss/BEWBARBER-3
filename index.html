<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bew Barber Booking System</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-in { animation: fadeIn 0.3s ease-in-out; }
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        .animate-progress { animation: progress 1s infinite linear; transform-origin: left; }
        @keyframes progress { 0% { transform: scaleX(0); } 50% { transform: scaleX(0.5); } 100% { transform: scaleX(1); } }
    </style>
</head>
<body class="bg-slate-900 text-slate-200 font-sans">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;
        
        // --- Embedded Icons (Complete Set) ---
        const IconBase = ({ children, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>{children}</svg>
        );
        const Icons = {
            Calendar: (p) => <IconBase {...p}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></IconBase>,
            Clock: (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></IconBase>,
            Scissors: (p) => <IconBase {...p}><circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><line x1="20" x2="8.12" y1="4" y2="15.88"/><line x1="14.47" x2="20" y1="14.48" y2="20"/><line x1="8.12" x2="12" y1="8.12" y2="12"/></IconBase>,
            User: (p) => <IconBase {...p}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></IconBase>,
            Phone: (p) => <IconBase {...p}><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></IconBase>,
            CheckCircle: (p) => <IconBase {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></IconBase>,
            AlertCircle: (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></IconBase>,
            Loader2: (p) => <IconBase {...p}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></IconBase>,
            Settings: (p) => <IconBase {...p}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></IconBase>,
            Lock: (p) => <IconBase {...p}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></IconBase>,
            Edit3: (p) => <IconBase {...p}><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></IconBase>,
            Plus: (p) => <IconBase {...p}><line x1="12" x2="12" y1="5" y2="19"/><line x1="5" x2="19" y1="12" y2="12"/></IconBase>,
            Trash2: (p) => <IconBase {...p}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></IconBase>,
            ImageIcon: (p) => <IconBase {...p}><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></IconBase>,
            X: (p) => <IconBase {...p}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconBase>,
            Search: (p) => <IconBase {...p}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></IconBase>,
            Power: (p) => <IconBase {...p}><path d="M18.36 6.64a9 9 0 1 1-12.73 0"/><line x1="12" x2="12" y1="2" y2="12"/></IconBase>,
            RefreshCw: (p) => <IconBase {...p}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></IconBase>,
            ChevronDown: (p) => <IconBase {...p}><path d="m6 9 6 6 6-6"/></IconBase>,
            ChevronUp: (p) => <IconBase {...p}><path d="m18 15-6-6-6 6"/></IconBase>,
            Upload: (p) => <IconBase {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></IconBase>,
            Save: (p) => <IconBase {...p}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></IconBase>,
            List: (p) => <IconBase {...p}><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></IconBase>,
            FileText: (p) => <IconBase {...p}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></IconBase>,
            BarChart: (p) => <IconBase {...p}><line x1="12" x2="12" y1="20" y2="10"/><line x1="18" x2="18" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="16"/></IconBase>,
            Camera: (p) => <IconBase {...p}><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></IconBase>
        };

        const { Calendar, Clock, Scissors, User, Phone, CheckCircle, AlertCircle, Loader2, Settings, Lock, Edit3, Plus, Trash2, ImageIcon, X, Search, Power, RefreshCw, ChevronDown, ChevronUp, Upload, Save, List, FileText, BarChart, Camera } = Icons;

        // --- Config & Helpers ---
        const FIXED_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxeMXvseSuyAoWNUNzMuf89fz2lmYr8Cb-heiiUDCGBiT9Akwwu1-_2iim6BbQJotPf/exec";
        const ALL_BARBERS = ["‡∏ä‡πà‡∏≤‡∏á‡∏ö‡∏¥‡∏ß (Master)"];
        const TIME_SLOTS = ["10:00", "11:00", "12:00", "13:00", "14:00", "15:00", "16:00", "17:00", "18:00", "19:00"];

        // --- ‡πÄ‡∏û‡∏¥‡πà‡∏° Status Mapping ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏õ‡∏•‡∏†‡∏≤‡∏©‡∏≤ ---
        const statusMap = {
            'All': '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
            'Pending': '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£',
            'Approved': '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß',
            'Completed': '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô',
            'Rejected': '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
        };

        const getDisplayImageUrl = (url) => {
            if (!url) return '';
            try {
                if (url.includes('drive.google.com') && url.includes('id=')) {
                    const idMatch = url.match(/id=([^&]+)/) || url.match(/\/d\/([^/]+)/);
                    if (idMatch) return `https://drive.google.com/thumbnail?id=${idMatch[1]}&sz=w1000`;
                }
            } catch (e) { return ''; }
            return url;
        };

        // --- Sub-Components ---

        const LiveQueueStatus = ({ selectedDate, busySlots }) => {
            if (!selectedDate) return null;
            const todaysBookings = busySlots.filter(s => s.startsWith(selectedDate));
            const slotsByTime = {};
            todaysBookings.forEach(s => {
                const parts = s.split('|');
                const time = parts[1];
                const barber = parts[2];
                if (!slotsByTime[time]) slotsByTime[time] = [];
                slotsByTime[time].push(barber);
            });

            return (
                <div className="mt-6 bg-slate-800 p-4 rounded-xl border border-slate-700 animate-in">
                    <h3 className="text-yellow-500 font-bold mb-3 flex items-center gap-2 text-sm">
                        <List size={16}/> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏¥‡∏ß‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà {selectedDate}
                    </h3>
                    <div className="space-y-2 max-h-48 overflow-y-auto pr-1">
                        {TIME_SLOTS.map(t => {
                            const busyBarbers = slotsByTime[t] || [];
                            const isFull = busyBarbers.length >= ALL_BARBERS.length;
                            return (
                                <div key={t} className={`flex justify-between items-center p-2 rounded text-xs border ${isFull ? 'bg-red-900/20 border-red-900/50' : 'bg-slate-900/50 border-slate-800'}`}>
                                    <span className="font-bold w-12 text-slate-400">{t} ‡∏ô.</span>
                                    <div className="flex-1 px-2">
                                        {busyBarbers.length > 0 ? (
                                            <div className="flex flex-wrap gap-1">
                                                {busyBarbers.map((b, i) => (
                                                    <span key={i} className="bg-red-500/20 text-red-400 px-1.5 py-0.5 rounded-[4px] text-[10px] truncate max-w-[100px]">{b}</span>
                                                ))}
                                            </div>
                                        ) : (
                                            <span className="text-green-500/50 italic">‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏∏‡∏Å‡∏ó‡πà‡∏≤‡∏ô</span>
                                        )}
                                    </div>
                                    <div className={`w-2 h-2 rounded-full ${isFull ? 'bg-red-500' : 'bg-green-500'}`}></div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const AdminDashboard = ({ allBookings }) => {
            const stats = useMemo(() => {
                if (!allBookings) return { income: 0, count: 0, byBarber: {} };
                const validBookings = allBookings.filter(b => b.status === 'Completed' || b.status === 'Approved');
                const income = validBookings.reduce((sum, b) => sum + (parseInt(b.price) || 0), 0);
                const byBarber = {};
                ALL_BARBERS.forEach(b => byBarber[b] = 0);
                validBookings.forEach(b => { if(byBarber[b] !== undefined) byBarber[b]++; });
                return { income, count: validBookings.length, byBarber };
            }, [allBookings]);

            const maxVal = Math.max(...Object.values(stats.byBarber), 1);

            return (
                <div className="space-y-4 animate-in">
                    <div className="grid grid-cols-2 gap-4">
                        <div className="bg-slate-800 p-4 rounded-xl border border-green-500/30">
                            <div className="text-slate-400 text-xs">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°</div>
                            <div className="text-2xl font-bold text-green-400">‡∏ø{stats.income.toLocaleString()}</div>
                        </div>
                        <div className="bg-slate-800 p-4 rounded-xl border border-blue-500/30">
                            <div className="text-slate-400 text-xs">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏¥‡∏ß</div>
                            <div className="text-2xl font-bold text-blue-400">{stats.count}</div>
                        </div>
                    </div>
                    <div className="bg-slate-800 p-4 rounded-xl border border-slate-700">
                        <h4 className="text-white font-bold mb-3 flex items-center gap-2"><BarChart size={16}/> ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ä‡πà‡∏≤‡∏á</h4>
                        <div className="space-y-3">
                            {Object.entries(stats.byBarber).map(([name, count]) => (
                                <div key={name}>
                                    <div className="flex justify-between text-xs text-slate-300 mb-1">
                                        <span>{name}</span><span>{count} ‡∏Ñ‡∏¥‡∏ß</span>
                                    </div>
                                    <div className="w-full bg-slate-700 rounded-full h-2">
                                        <div className="bg-yellow-500 h-2 rounded-full transition-all duration-500" style={{width: `${(count/maxVal)*100}%`}}></div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const AdminLogin = ({ onLogin, onCancel }) => {
            const [pass, setPass] = useState('');
            const [error, setError] = useState('');
            return (
                <div className="min-h-screen bg-slate-900 flex items-center justify-center p-4">
                    <div className="bg-slate-800 p-8 rounded-xl shadow-2xl w-full max-w-sm border border-slate-700 animate-in">
                        <h2 className="text-xl font-bold text-yellow-500 mb-4 flex items-center gap-2"><Lock size={20}/> Admin Login</h2>
                        <form onSubmit={(e) => { 
                            e.preventDefault(); 
                            if (!onLogin(pass)) setError('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                            else setError('');
                        }} className="space-y-4">
                            <input type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (1234)" value={pass} onChange={e => {setPass(e.target.value); setError('');}} className="w-full bg-slate-900 border border-slate-600 rounded p-3 text-white focus:border-yellow-500 outline-none transition-colors"/>
                            {error && <p className="text-red-500 text-sm text-center">{error}</p>}
                            <div className="flex gap-2">
                                <button type="submit" className="flex-1 bg-yellow-500 text-slate-900 py-2 rounded font-bold hover:bg-yellow-400 transition-colors">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                                <button type="button" onClick={onCancel} className="px-4 py-2 text-slate-400 hover:text-white transition-colors">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        const AdminPanel = ({ 
            shopStatus, toggleShopStatus, fetchData, loadingData, allBookings,
            setEditingBooking, editingBooking, handleSaveEditBooking, 
            styles, handleAddStyle, handleUpdateStyle, handleDeleteStyle, handleImageUpload, saveStylesToServer, uploadingId, onBack,
            hairstyleImages, uploadingHairstyle, handleHairstyleImageUpload, deleteHairstyleImage, fetchHairstyleImages,
            isAutoSaving
        }) => {
            const [tab, setTab] = useState('dashboard');
            const [filterStatus, setFilterStatus] = useState('All');
            const [confirmDeleteId, setConfirmDeleteId] = useState(null);
            const [selectingImageFor, setSelectingImageFor] = useState(null);

            // Filter logic
            const filteredBookings = useMemo(() => {
                if(!allBookings) return [];
                let res = [...allBookings].sort((a,b) => b.id - a.id);
                if(filterStatus !== 'All') res = res.filter(b => b.status === filterStatus);
                return res;
            }, [allBookings, filterStatus]);

            const getStatusColor = (s) => {
                if(s === 'Approved') return 'text-green-400 bg-green-900/30';
                if(s === 'Rejected') return 'text-red-400 bg-red-900/30';
                if(s === 'Completed') return 'text-blue-400 bg-blue-900/30';
                return 'text-yellow-400 bg-yellow-900/30'; // Pending
            };

            return (
                <div className="min-h-screen bg-slate-900 text-slate-200 font-sans pb-20 animate-in">
                    <div className="bg-slate-800 p-4 border-b border-slate-700 sticky top-0 z-20 flex justify-between items-center shadow-lg">
                        <h1 className="font-bold text-yellow-500 flex items-center gap-2"><Settings size={20}/> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡πâ‡∏≤‡∏ô</h1>
                        <button onClick={onBack} className="text-sm bg-slate-700 px-3 py-1 rounded hover:bg-slate-600 text-white">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô</button>
                    </div>
                    
                    <div className="flex p-2 bg-slate-800 gap-1 overflow-x-auto">
                        {['dashboard', 'queue', 'menu', 'images'].map(t => (
                            <button key={t} onClick={() => setTab(t)} className={`flex-1 py-2 text-xs font-bold uppercase rounded ${tab === t ? 'bg-yellow-500 text-slate-900' : 'bg-slate-700 text-slate-400'}`}>
                                {t === 'dashboard' ? '‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î' : t === 'queue' ? '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á' : t === 'menu' ? '‡πÄ‡∏°‡∏ô‡∏π/‡∏£‡πâ‡∏≤‡∏ô' : '‡∏£‡∏π‡∏õ‡∏ó‡∏£‡∏á‡∏ú‡∏°'}
                            </button>
                        ))}
                    </div>

                    <div className="max-w-3xl mx-auto p-4 space-y-6">
                        
                        {tab === 'dashboard' && <AdminDashboard allBookings={allBookings} />}

                        {tab === 'menu' && (
                            <div className="space-y-6 animate-in">
                                <div className="bg-slate-800 p-4 rounded-xl border border-slate-700 flex justify-between items-center">
                                    <div><h3 className="font-bold text-white">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡πâ‡∏≤‡∏ô</h3><p className={`text-xs ${shopStatus==='OPEN'?'text-green-500':'text-red-500'}`}>{shopStatus==='OPEN'?'üü¢ ‡πÄ‡∏õ‡∏¥‡∏î':'üî¥ ‡∏õ‡∏¥‡∏î'}</p></div>
                                    <button onClick={toggleShopStatus} className="bg-slate-700 px-4 py-2 rounded text-xs">‡∏™‡∏•‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>
                                </div>
                                <div className="bg-slate-800 p-4 rounded-xl border border-slate-700">
                                    <div className="flex justify-between mb-4 items-center"><h3 className="font-bold text-white">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏£‡∏á‡∏ú‡∏°</h3>
                                    <div className="flex gap-2 items-center">
                                        {isAutoSaving && <span className="text-yellow-500 text-xs flex items-center gap-1"><Loader2 size={12} className="animate-spin"/> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...</span>}
                                        <button onClick={handleAddStyle} className="bg-green-600/20 text-green-500 px-2 py-1 rounded text-xs">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                                        <button onClick={saveStylesToServer} className="bg-blue-600/20 text-blue-500 px-2 py-1 rounded text-xs">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏•‡∏¢</button>
                                    </div></div>
                                    <div className="grid gap-4">
                                        {styles.map(s => (
                                            <div key={s.id} className="bg-slate-900 p-3 rounded border border-slate-700">
                                                <div className="flex gap-3 relative">
                                                    <div className="w-20 h-20 bg-black rounded overflow-hidden shrink-0 relative">
                                                        {s.image && <img src={getDisplayImageUrl(s.image)} className="w-full h-full object-cover" onError={e=>e.target.style.display='none'}/>}
                                                        <label className="absolute inset-0 flex items-center justify-center cursor-pointer bg-black/50 opacity-0 hover:opacity-100 transition-opacity"><Upload size={16}/><input type="file" className="hidden" onChange={e=>handleImageUpload(e, s.id)}/></label>
                                                        {uploadingId === s.id && <div className="absolute inset-0 bg-black/80 flex items-center justify-center"><Loader2 className="animate-spin text-yellow-500"/></div>}
                                                    </div>
                                                    <div className="flex-1 space-y-2 min-w-0">
                                                        <input value={s.name} onChange={e=>handleUpdateStyle(s.id,'name',e.target.value)} className="w-full bg-transparent border-b border-slate-700 text-sm outline-none" placeholder="‡∏ä‡∏∑‡πà‡∏≠"/>
                                                        <input type="number" value={s.price} onChange={e=>handleUpdateStyle(s.id,'price',e.target.value)} className="w-full bg-transparent border-b border-slate-700 text-sm outline-none text-yellow-500" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤"/>
                                                        <input value={s.image} readOnly className="w-full bg-transparent border-b border-slate-700 text-[10px] text-slate-500 outline-none truncate"/>
                                                    </div>
                                                    
                                                    {/* Delete Button */}
                                                    <div className="flex flex-col justify-start">
                                                        {confirmDeleteId === s.id ? (
                                                            <div className="flex flex-col gap-1 z-20 absolute top-2 right-2 bg-slate-800 p-2 rounded shadow-lg border border-slate-600">
                                                                <button onClick={() => { handleDeleteStyle(s.id); setConfirmDeleteId(null); }} className="bg-red-600 text-white text-[10px] px-2 py-1 rounded">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                                                                <button onClick={() => setConfirmDeleteId(null)} className="bg-slate-600 text-white text-[10px] px-2 py-1 rounded">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                                                            </div>
                                                        ) : (
                                                            <button onClick={() => setConfirmDeleteId(s.id)} className="text-slate-600 hover:text-red-500 p-1"><Trash2 size={18}/></button>
                                                        )}
                                                    </div>
                                                </div>
                                                
                                                {/* ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á */}
                                                {hairstyleImages.length > 0 && (
                                                    <div className="mt-3 pt-3 border-t border-slate-800">
                                                        {selectingImageFor === s.id ? (
                                                            <div className="space-y-2">
                                                                <div className="flex justify-between items-center">
                                                                    <span className="text-xs text-slate-400">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á ({hairstyleImages.length} ‡∏£‡∏π‡∏õ):</span>
                                                                    <button onClick={() => setSelectingImageFor(null)} className="text-[10px] text-slate-500 hover:text-white">‡∏õ‡∏¥‡∏î</button>
                                                                </div>
                                                                <div className="grid grid-cols-4 gap-2 max-h-48 overflow-y-auto">
                                                                    {hairstyleImages.map(img => (
                                                                        <div key={img.id} 
                                                                            onClick={() => { handleUpdateStyle(s.id, 'image', img.url); setSelectingImageFor(null); }}
                                                                            className={`aspect-square rounded overflow-hidden cursor-pointer border-2 hover:border-yellow-500 transition-all ${s.image === img.url ? 'border-yellow-500 ring-2 ring-yellow-500/50' : 'border-slate-700'}`}
                                                                        >
                                                                            <img src={img.thumbnailUrl} alt={img.name} className="w-full h-full object-cover" loading="lazy"/>
                                                                        </div>
                                                                    ))}
                                                                </div>
                                                            </div>
                                                        ) : (
                                                            <button 
                                                                onClick={() => setSelectingImageFor(s.id)}
                                                                className="text-xs flex items-center gap-1 text-blue-400 hover:text-blue-300 transition-colors"
                                                            >
                                                                <ImageIcon size={14}/> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á ({hairstyleImages.length})
                                                            </button>
                                                        )}
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {tab === 'images' && (
                            <div className="space-y-6 animate-in">
                                <div className="bg-slate-800 p-4 rounded-xl border border-slate-700">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="font-bold text-white flex items-center gap-2">
                                            <ImageIcon size={18}/> ‡∏Ñ‡∏•‡∏±‡∏á‡∏£‡∏π‡∏õ‡∏ó‡∏£‡∏á‡∏ú‡∏° ({hairstyleImages.length})
                                        </h3>
                                        <label className={`px-4 py-2 rounded text-xs font-bold flex items-center gap-2 cursor-pointer ${uploadingHairstyle ? 'bg-slate-600' : 'bg-green-600 hover:bg-green-500 text-white'}`}>
                                            {uploadingHairstyle ? <><Loader2 className="animate-spin" size={14}/> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î...</> : <><Plus size={14}/> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà</>}
                                            <input type="file" className="hidden" accept="image/*" onChange={handleHairstyleImageUpload} disabled={uploadingHairstyle}/>
                                        </label>
                                    </div>
                                    
                                    {hairstyleImages.length === 0 ? (
                                        <div className="text-center py-8 text-slate-500">
                                            <ImageIcon size={48} className="mx-auto mb-2 opacity-30"/>
                                            <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏ó‡∏£‡∏á‡∏ú‡∏°</p>
                                            <p className="text-xs mt-1">‡∏Ñ‡∏•‡∏¥‡∏Å "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î</p>
                                        </div>
                                    ) : (
                                        <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                                            {hairstyleImages.map((img, idx) => (
                                                <div key={img.id} className="bg-slate-900 rounded-lg overflow-hidden border border-slate-700 group relative">
                                                    <div className="aspect-square bg-black relative">
                                                        <img src={img.thumbnailUrl} alt={img.name} className="w-full h-full object-cover" onError={e => {e.target.src = img.url;}}/>
                                                        <div className="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2">
                                                            <a href={img.url} target="_blank" className="bg-white/20 hover:bg-white/30 p-2 rounded-full text-white">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/><path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7Z"/></svg>
                                                            </a>
                                                            <button onClick={() => deleteHairstyleImage(img.id)} className="bg-red-500/80 hover:bg-red-500 p-2 rounded-full text-white">
                                                                <Trash2 size={16}/>
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div className="p-2">
                                                        <p className="text-xs text-slate-300 truncate" title={img.name}>{img.name}</p>
                                                        <p className="text-[10px] text-slate-500">{new Date(img.created).toLocaleDateString('th-TH')}</p>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                    
                                    <div className="mt-4 p-3 bg-slate-900/50 rounded-lg text-xs text-slate-400">
                                        <p className="font-bold text-slate-300 mb-1">üí° ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</p>
                                        <ul className="list-disc list-inside space-y-1">
                                            <li>‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏ó‡∏£‡∏á‡∏ú‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á</li>
                                            <li>‡∏£‡∏π‡∏õ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå BEW_Hairstyles ‡∏ö‡∏ô Google Drive</li>
                                            <li>‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥ URL ‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏£‡∏á‡∏ú‡∏°‡πÑ‡∏î‡πâ</li>
                                            <li>‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏ï‡πá‡∏° ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        )}

                        {tab === 'queue' && (
                            <div className="space-y-4 animate-in">
                                <div className="flex gap-2 overflow-x-auto pb-2">
                                    {/* ‡∏ô‡∏≥ statusMap ‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏∏‡πà‡∏° Filter ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ */}
                                    {['All', 'Pending', 'Approved', 'Completed', 'Rejected'].map(s => (
                                        <button key={s} onClick={() => setFilterStatus(s)} className={`px-3 py-1 rounded-full text-xs whitespace-nowrap ${filterStatus === s ? 'bg-yellow-500 text-slate-900 font-bold' : 'bg-slate-800 text-slate-400'}`}>{statusMap[s]}</button>
                                    ))}
                                </div>
                                <div className="space-y-2">
                                    {filteredBookings.map((b) => (
                                        <div key={b.id} className="bg-slate-800 p-4 rounded-xl border border-slate-700 flex justify-between items-start cursor-pointer hover:border-yellow-500/50 transition-colors" onClick={() => setEditingBooking(b)}>
                                            <div>
                                                <div className="flex items-center gap-2 mb-1">
                                                    {/* ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏î‡πâ‡∏ß‡∏¢‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ */}
                                                    <span className={`text-[10px] px-2 py-0.5 rounded font-bold uppercase ${getStatusColor(b.status)}`}>{statusMap[b.status] || b.status}</span>
                                                    <span className="text-slate-400 text-xs">{b.date} {b.time}</span>
                                                </div>
                                                <div className="font-bold text-white">{b.name} <span className="text-slate-500 font-normal">({b.phone})</span></div>
                                                <div className="text-xs text-slate-400">{b.service} - {b.barber}</div>
                                            </div>
                                            {b.slip && <div className="text-green-500"><FileText size={16}/></div>}
                                        </div>
                                    ))}
                                    {filteredBookings.length === 0 && <p className="text-center text-slate-500 py-8">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>}
                                </div>
                            </div>
                        )}

                        {/* Edit Modal */}
                        {editingBooking && (
                            <div className="fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4 backdrop-blur-sm overflow-y-auto">
                                <div className="bg-slate-900 p-6 rounded-xl w-full max-w-md border border-yellow-500 shadow-2xl animate-in my-8">
                                    <div className="flex justify-between items-start mb-6">
                                        <h3 className="font-bold text-xl text-white">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏ß #{editingBooking.id}</h3>
                                        <button onClick={() => setEditingBooking(null)}><X size={24}/></button>
                                    </div>
                                    
                                    <form onSubmit={handleSaveEditBooking} className="space-y-6">
                                        <div className="bg-slate-800 p-4 rounded-lg">
                                            <label className="text-xs text-slate-400 block mb-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (Status)</label>
                                            <div className="grid grid-cols-2 gap-2">
                                                {/* ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡∏≠‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡πÉ‡∏ä‡πâ statusMap ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ */}
                                                {['Pending', 'Approved', 'Rejected', 'Completed'].map(s => (
                                                    <button type="button" key={s} onClick={() => setEditingBooking({...editingBooking, status: s})}
                                                        className={`py-2 px-3 rounded text-xs font-bold border transition-colors ${editingBooking.status === s ? getStatusColor(s) + ' border-current' : 'border-slate-700 text-slate-500'}`}>
                                                        {statusMap[s]}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>

                                        {editingBooking.slip ? (
                                            <div className="bg-slate-800 p-4 rounded-lg">
                                                <label className="text-xs text-slate-400 block mb-2 flex items-center gap-2"><FileText size={14}/> ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
                                                <a href={getDisplayImageUrl(editingBooking.slip)} target="_blank" className="block relative aspect-video bg-black rounded overflow-hidden group">
                                                    <img src={getDisplayImageUrl(editingBooking.slip)} className="w-full h-full object-contain" />
                                                    <div className="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-xs">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏π‡∏õ‡πÄ‡∏ï‡πá‡∏°</div>
                                                </a>
                                            </div>
                                        ) : <div className="text-xs text-red-400 bg-red-900/10 p-2 rounded text-center">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ</div>}

                                        <div className="bg-slate-800 p-4 rounded-lg space-y-3">
                                            <h4 className="text-sm font-bold text-white flex items-center gap-2 border-b border-slate-700 pb-2"><Camera size={16}/> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h4>
                                            
                                            <div>
                                                <label className="text-xs text-slate-400">‡∏™‡∏†‡∏≤‡∏û‡∏ú‡∏°</label>
                                                <select className="w-full bg-slate-900 border border-slate-700 rounded p-2 text-sm text-white mt-1" 
                                                    value={editingBooking.hairCond || ''} onChange={e => setEditingBooking({...editingBooking, hairCond: e.target.value})}>
                                                    <option value="">- ‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏†‡∏≤‡∏û‡∏ú‡∏° -</option>
                                                    <option value="Normal">‡∏õ‡∏Å‡∏ï‡∏¥</option>
                                                    <option value="Dry">‡πÅ‡∏´‡πâ‡∏á‡πÄ‡∏™‡∏µ‡∏¢</option>
                                                    <option value="Oily">‡∏°‡∏±‡∏ô</option>
                                                    <option value="Thin">‡∏ö‡∏≤‡∏á</option>
                                                </select>
                                            </div>

                                            <div className="grid grid-cols-2 gap-3">
                                                {[
                                                    { key: 'beforeImg', label: 'Before' }, 
                                                    { key: 'afterImg', label: 'After' }
                                                ].map(field => (
                                                    <div key={field.key}>
                                                        <label className="text-[10px] text-slate-400 mb-1 block">{field.label}</label>
                                                        <div className="aspect-square bg-slate-900 rounded border border-slate-700 relative flex items-center justify-center overflow-hidden">
                                                            {editingBooking[field.key] ? 
                                                                <img src={getDisplayImageUrl(editingBooking[field.key])} className="w-full h-full object-cover"/> : 
                                                                <Camera size={20} className="text-slate-700"/>
                                                            }
                                                            <label className="absolute inset-0 flex items-center justify-center bg-black/50 opacity-0 hover:opacity-100 cursor-pointer transition-opacity">
                                                                <Upload size={16}/><input type="file" className="hidden" onChange={e => handleImageUpload(e, editingBooking.id, (url) => setEditingBooking({...editingBooking, [field.key]: url}))}/>
                                                            </label>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        <button type="submit" disabled={loadingData} className="w-full bg-yellow-500 hover:bg-yellow-400 text-slate-900 font-bold py-3 rounded-lg shadow-lg flex justify-center items-center gap-2">
                                            {loadingData ? <Loader2 className="animate-spin"/> : <Save size={18}/>} ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
                                        </button>
                                    </form>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const CheckStatus = ({ phone, setPhone, onCheck, statusState, myBookings, onBack }) => (
            <div className="min-h-screen bg-slate-900 text-slate-200 font-sans">
                <div className="max-w-md mx-auto min-h-screen bg-slate-800 flex flex-col">
                    <div className="bg-slate-700 p-4 flex items-center gap-4 sticky top-0 z-20"><button onClick={onBack} className="bg-slate-600 p-2 rounded-full hover:bg-slate-500 transition-colors"><X size={16}/></button><h1 className="font-bold text-lg">‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h1></div>
                    <div className="p-6 space-y-6">
                        <form onSubmit={(e) => { e.preventDefault(); onCheck(); }} className="space-y-4">
                            <div className="space-y-2"><label className="text-sm text-slate-400">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label><input type="tel" value={phone} onChange={e => setPhone(e.target.value)} className="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 text-white text-center text-lg tracking-wider focus:border-yellow-500 outline-none transition-colors" placeholder="08X-XXX-XXXX" required/></div>
                            <button type="submit" className="w-full bg-blue-600 hover:bg-blue-500 text-white py-3 rounded-lg font-bold flex justify-center items-center gap-2 transition-colors">{statusState === 'loading' ? <Loader2 className="animate-spin"/> : <Search size={20}/>} ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                        </form>
                        {statusState === 'found' && (
                            <div className="space-y-4 animate-in">
                                <h3 className="text-green-400 font-bold flex items-center gap-2"><CheckCircle size={16}/> ‡∏û‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ ({myBookings.length})</h3>
                                {myBookings.map((bk, idx) => (
                                    <div key={idx} className="bg-slate-900 p-4 rounded-lg border-l-4 border-yellow-500 shadow-lg animate-in" style={{animationDelay: `${idx * 0.1}s`}}>
                                        <div className="flex justify-between items-start mb-2"><span className="text-yellow-500 font-bold text-lg">{bk.time} ‡∏ô.</span><span className="text-xs text-slate-500 bg-slate-800 px-2 py-1 rounded">{bk.date}</span></div>
                                        <div className="text-sm text-slate-300 space-y-1"><p>‚úÇÔ∏è {bk.service}</p><p>üë®‚Äçü¶≤ {bk.barber}</p></div>
                                    </div>
                                ))}
                            </div>
                        )}
                        {statusState === 'not-found' && <div className="text-center py-8 text-slate-500 bg-slate-900/50 rounded-lg animate-in"><AlertCircle size={40} className="mx-auto mb-2 opacity-50"/><p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p></div>}
                    </div>
                </div>
            </div>
        );

        // --- Main App Component ---

        const BarberBookingApp = () => {
            const defaultStyles = [
                { id: 1, name: 'Vintage Slick Back', price: 350, image: 'https://images.unsplash.com/photo-1585747860715-2ba37e788b70?w=500&auto=format&fit=crop&q=60' },
                { id: 2, name: 'Korean Two Block', price: 300, image: 'https://images.unsplash.com/photo-1621605815971-fbc98d665033?w=500&auto=format&fit=crop&q=60' },
                { id: 3, name: 'Skin Fade / Undercut', price: 250, image: 'https://images.unsplash.com/photo-1605497788044-5a32c7078486?w=500&auto=format&fit=crop&q=60' },
                { id: 4, name: 'Mullet Modern', price: 400, image: 'https://images.unsplash.com/photo-1599351431202-1e0f0137899a?w=500&auto=format&fit=crop&q=60' }
            ];

            const [view, setView] = useState('customer');
            const [hairstyles, setHairstyles] = useState(defaultStyles);
            const [shopStatus, setShopStatus] = useState('OPEN');
            const [busySlots, setBusySlots] = useState([]);
            const [formData, setFormData] = useState({ name: '', phone: '', date: '', time: '', service: '‡∏ï‡∏±‡∏î‡∏ú‡∏°', selectedStyle: null, barber: '‡∏ä‡πà‡∏≤‡∏á‡∏ó‡πà‡∏≤‡∏ô‡πÑ‡∏´‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ' });
            
            const [checkPhone, setCheckPhone] = useState('');
            const [myBookings, setMyBookings] = useState([]);
            const [checkStatusState, setCheckStatusState] = useState('idle');

            const [adminSearchQuery, setAdminSearchQuery] = useState('');
            const [adminSearchResults, setAdminSearchResults] = useState([]);
            const [isSearching, setIsSearching] = useState(false);
            const [editingBooking, setEditingBooking] = useState(null);
            
            const [status, setStatus] = useState('idle');
            const [message, setMessage] = useState('');
            const [loadingData, setLoadingData] = useState(false);
            const [uploadingId, setUploadingId] = useState(null);
            
            // For Dashboard
            const [allBookings, setAllBookings] = useState([]);
            
            // For Hairstyle Images (NEW)
            const [hairstyleImages, setHairstyleImages] = useState([]);
            const [uploadingHairstyle, setUploadingHairstyle] = useState(false);
            const [isInitialLoad, setIsInitialLoad] = useState(true);
            const [isAutoSaving, setIsAutoSaving] = useState(false);

            useEffect(() => {
                // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Server ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏™‡∏°‡∏≠ (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà localStorage) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
                fetchData(false, true);
                // Mark initial load complete after a short delay
                setTimeout(() => setIsInitialLoad(false), 1000);
            }, []);

            // Auto-Refresh for Customer (‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó styles ‡∏à‡∏≤‡∏Å server ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
            // ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Admin (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)
            useEffect(() => {
                const interval = setInterval(() => { 
                    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà admin ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô admin ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà tab menu ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó styles
                    const shouldUpdateStyles = view !== 'admin';
                    fetchData(false, shouldUpdateStyles); 
                }, 15000); 
                return () => clearInterval(interval);
            }, [fetchData, view]);

            // AUTO-SAVE: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏£‡∏á‡∏ú‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å)
            useEffect(() => {
                if (isInitialLoad) return;
                
                setIsAutoSaving(true);
                const timeoutId = setTimeout(async () => {
                    const form = new FormData(); 
                    form.append('action', 'saveStyles'); 
                    form.append('styles', JSON.stringify(hairstyles));
                    try { 
                        await fetch(FIXED_SCRIPT_URL, {method:'POST', body: form, mode: 'no-cors'}); 
                        console.log('‚úÖ Auto-saved styles to server');
                    } catch(e) {
                        console.error('‚ùå Auto-save failed:', e);
                    } finally {
                        setIsAutoSaving(false);
                    }
                }, 1500); // Debounce 1.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                
                return () => clearTimeout(timeoutId);
            }, [hairstyles, isInitialLoad]);

            const fetchData = useCallback(async (isManual = false, updateStyles = true) => {
                setLoadingData(true);
                try {
                    const response = await fetch(`${FIXED_SCRIPT_URL}?action=getData`);
                    const data = await response.json();
                    if (data.shopStatus) setShopStatus(data.shopStatus);
                    if (data.busySlots) setBusySlots(data.busySlots);
                    if (data.allBookings) setAllBookings(data.allBookings);
                    if (updateStyles && data.styles && Array.isArray(data.styles) && data.styles.length > 0) {
                        setHairstyles(data.styles);
                    }
                    if (isManual) alert("‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
                } catch (error) { if (isManual) alert(`‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß`); } 
                finally { setLoadingData(false); }
            }, []);

            // NEW: ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡∏ó‡∏£‡∏á‡∏ú‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            const fetchHairstyleImages = useCallback(async () => {
                try {
                    const response = await fetch(`${FIXED_SCRIPT_URL}?action=getHairstyleImages`);
                    const data = await response.json();
                    if (data.result === "success" && data.images) {
                        setHairstyleImages(data.images);
                    }
                } catch (error) {
                    console.error("Error fetching hairstyle images:", error);
                }
            }, []);

            // NEW: ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏ó‡∏£‡∏á‡∏ú‡∏°‡πÉ‡∏´‡∏°‡πà
            const handleHairstyleImageUpload = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                setUploadingHairstyle(true);
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = async () => {
                    const form = new FormData();
                    form.append('action', 'uploadHairstyleImage');
                    form.append('fileData', reader.result.split(',')[1]);
                    form.append('mimeType', file.type);
                    form.append('fileName', file.name);
                    
                    try {
                        const res = await fetch(FIXED_SCRIPT_URL, { method: 'POST', body: form });
                        const data = await res.json();
                        if (data.result === 'success') {
                            await fetchHairstyleImages();
                            alert('‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏ó‡∏£‡∏á‡∏ú‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                        } else {
                            alert('‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' + data.message);
                        }
                    } catch (e) {
                        alert('‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');
                    } finally {
                        setUploadingHairstyle(false);
                    }
                };
            };

            // NEW: ‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏ó‡∏£‡∏á‡∏ú‡∏°
            const deleteHairstyleImage = async (fileId) => {
                if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏ô‡∏µ‡πâ?')) return;
                
                const form = new FormData();
                form.append('action', 'deleteHairstyleImage');
                form.append('fileId', fileId);
                
                try {
                    const res = await fetch(FIXED_SCRIPT_URL, { method: 'POST', body: form });
                    const data = await res.json();
                    if (data.result === 'success') {
                        await fetchHairstyleImages();
                        alert('‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                    } else {
                        alert('‡∏•‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' + data.message);
                    }
                } catch (e) {
                    alert('‡∏•‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');
                }
            };

            // Load hairstyle images on admin view and customer view
            useEffect(() => {
                if (view === 'admin' || view === 'customer') {
                    fetchHairstyleImages();
                }
            }, [view, fetchHairstyleImages]);

            // Updated Busy Logic
            const isSlotBusy = (time) => {
                if (!formData.date) return false;
                if (formData.barber !== '‡∏ä‡πà‡∏≤‡∏á‡∏ó‡πà‡∏≤‡∏ô‡πÑ‡∏´‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ') {
                    return busySlots.includes(`${formData.date}|${time}|${formData.barber}`);
                }
                const busyCount = ALL_BARBERS.filter(b => 
                    busySlots.includes(`${formData.date}|${time}|${b}`)
                ).length;
                return busyCount >= ALL_BARBERS.length;
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (isSlotBusy(formData.time)) { setStatus('error'); setMessage('‡∏Ñ‡∏¥‡∏ß‡∏ô‡∏µ‡πâ‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö'); return; }
                setStatus('loading');
                const formPayload = new FormData();
                formPayload.append('name', formData.name); formPayload.append('phone', formData.phone);
                formPayload.append('date', formData.date); formPayload.append('time', formData.time);
                formPayload.append('service', formData.service); formPayload.append('barber', formData.barber);
                formPayload.append('price', formData.selectedStyle ? formData.selectedStyle.price : '-');
                formPayload.append('imageUrl', formData.selectedStyle ? formData.selectedStyle.image : '');
                formPayload.append('action', 'booking');
                
                try {
                    await fetch(FIXED_SCRIPT_URL, { method: 'POST', body: formPayload, mode: 'no-cors' });
                    if (formData.barber !== '‡∏ä‡πà‡∏≤‡∏á‡∏ó‡πà‡∏≤‡∏ô‡πÑ‡∏´‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ') {
                        setBusySlots(prev => [...prev, `${formData.date}|${formData.time}|${formData.barber}`]);
                    }
                    setStatus('success'); setFormData({ ...formData, name: '', phone: '', date: '', time: '' });
                } catch (error) { setStatus('error'); setMessage('Error connecting'); }
            };

            const handleAdminLogin = (pass) => {
                if (pass === '1234') { 
                    setView('admin'); 
                    return true; // Success
                }
                return false; // Failed
            };

            const toggleShopStatus = async () => {
                const newStatus = shopStatus === 'OPEN' ? 'CLOSED' : 'OPEN';
                setShopStatus(newStatus);
                const form = new FormData(); form.append('action', 'toggleStatus'); form.append('status', newStatus);
                try { await fetch(FIXED_SCRIPT_URL, { method: 'POST', body: form, mode: 'no-cors' }); } catch(e){}
            };

            const handleAdminSearch = async (e) => {
                e.preventDefault(); setIsSearching(true);
                try {
                    const res = await fetch(`${FIXED_SCRIPT_URL}?action=searchAll&query=${adminSearchQuery}`);
                    const data = await res.json(); setAdminSearchResults(data.results || []);
                } catch(e) { alert('Error'); } finally { setIsSearching(false); }
            };

            const handleSaveEditBooking = async (e) => {
                e.preventDefault(); if(!editingBooking) return;
                const form = new FormData();
                form.append('action', 'updateBooking'); form.append('rowIndex', editingBooking.id);
                form.append('name', editingBooking.name); form.append('phone', editingBooking.phone);
                form.append('date', editingBooking.date); form.append('time', editingBooking.time);
                form.append('barber', editingBooking.barber);
                form.append('status', editingBooking.status);
                form.append('hairCond', editingBooking.hairCond || '');
                form.append('beforeImg', editingBooking.beforeImg || '');
                form.append('afterImg', editingBooking.afterImg || '');
                try {
                    await fetch(FIXED_SCRIPT_URL, { method: 'POST', body: form, mode: 'no-cors' });
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï state ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ fetch
                    setAllBookings(prev => prev.map(b => b.id === editingBooking.id ? editingBooking : b));
                    alert('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); 
                    setEditingBooking(null); 
                } catch(e) { alert('Error'); }
            };

            const handleImageUpload = async (e, id) => {
                const file = e.target.files[0]; if(!file) return; setUploadingId(id);
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = async () => {
                    const form = new FormData();
                    form.append('action', 'uploadImage'); form.append('fileData', reader.result.split(',')[1]);
                    form.append('mimeType', file.type); form.append('fileName', file.name);
                    try {
                        const res = await fetch(FIXED_SCRIPT_URL, { method: 'POST', body: form });
                        const data = await res.json();
                        if(data.result === 'success') {
                            setHairstyles(prev => prev.map(s => s.id === id ? { ...s, image: data.url } : s));
                            // Auto-save ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ú‡πà‡∏≤‡∏ô useEffect
                        }
                    } catch(e) { alert('Upload failed'); } finally { setUploadingId(null); }
                };
            };

            const checkMyBooking = () => {
                setCheckStatusState('loading');
                // ‡∏Å‡∏£‡∏≠‡∏á‡∏à‡∏≤‡∏Å allBookings ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß (Approved)
                const approvedBookings = allBookings.filter(b => 
                    b.phone === checkPhone && 
                    (b.status === 'Approved' || b.status === 'Completed')
                );
                
                if(approvedBookings.length > 0) { 
                    setMyBookings(approvedBookings); 
                    setCheckStatusState('found'); 
                } else { 
                    setCheckStatusState('not-found'); 
                }
            };

            if (view === 'admin-login') return <AdminLogin onLogin={handleAdminLogin} onCancel={() => setView('customer')} />;
            if (view === 'admin') return <AdminPanel 
                shopStatus={shopStatus} toggleShopStatus={toggleShopStatus} fetchData={fetchData} loadingData={loadingData}
                adminSearchQuery={adminSearchQuery} setAdminSearchQuery={setAdminSearchQuery} handleAdminSearch={handleAdminSearch}
                isSearching={isSearching} adminSearchResults={adminSearchResults} setEditingBooking={setEditingBooking} editingBooking={editingBooking}
                handleSaveEditBooking={handleSaveEditBooking} styles={hairstyles} 
                handleAddStyle={() => setHairstyles([...hairstyles, { id: Date.now() + Math.random(), name: '‡πÅ‡∏ö‡∏ö‡∏ó‡∏£‡∏á‡πÉ‡∏´‡∏°‡πà', price: 300, image: 'https://images.unsplash.com/photo-1599351431202-1e0f0137899a?w=500' }])}
                handleUpdateStyle={(id, f, v) => setHairstyles(prev => prev.map(s => s.id === id ? { ...s, [f]: v } : s))}
                handleDeleteStyle={(id) => {
                    // Custom Confirm Logic is handled inside AdminPanel now
                    setHairstyles(prev => prev.filter(s => s.id !== id));
                }}
                handleImageUpload={handleImageUpload} uploadingId={uploadingId}
                saveStylesToServer={async () => { 
                    const form = new FormData(); form.append('action', 'saveStyles'); form.append('styles', JSON.stringify(hairstyles));
                    try { await fetch(FIXED_SCRIPT_URL, {method:'POST', body: form, mode: 'no-cors'}); alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á Server ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!'); } catch(e){}
                }}
                onBack={() => {
                    setView('customer');
                    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å server ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
                    fetchData(false, true);
                }}
                allBookings={allBookings}
                hairstyleImages={hairstyleImages}
                uploadingHairstyle={uploadingHairstyle}
                handleHairstyleImageUpload={handleHairstyleImageUpload}
                deleteHairstyleImage={deleteHairstyleImage}
                fetchHairstyleImages={fetchHairstyleImages}
                isAutoSaving={isAutoSaving}
            />;
            if (view === 'check-status') return <CheckStatus phone={checkPhone} setPhone={setCheckPhone} onCheck={checkMyBooking} statusState={checkStatusState} myBookings={myBookings} onBack={() => setView('customer')} />;

            return (
                <div className="min-h-screen bg-slate-900 text-slate-200 font-sans selection:bg-yellow-500 selection:text-slate-900">
                    <div className="max-w-md mx-auto min-h-screen flex flex-col relative bg-slate-800 shadow-2xl overflow-hidden">
                        <div className="bg-gradient-to-r from-yellow-600 to-yellow-500 p-6 text-slate-900 relative">
                            <div className="flex justify-between items-start">
                                <div><h1 className="text-3xl font-bold tracking-tighter">BEW BARBER</h1><div className="flex items-center gap-2 mt-1">{shopStatus === 'OPEN' ? <span className="bg-green-600 text-white text-[10px] px-2 py-0.5 rounded-full font-bold flex items-center gap-1 animate-pulse"><span className="w-2 h-2 bg-white rounded-full"></span> OPEN</span> : <span className="bg-red-600 text-white text-[10px] px-2 py-0.5 rounded-full font-bold flex items-center gap-1"><Power size={8}/> CLOSED</span>}<p className="font-medium opacity-90 text-sm">‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏ï‡∏±‡∏î‡∏ú‡∏°‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</p></div></div>
                                <div className="flex gap-2"><button onClick={() => setView('check-status')} className="bg-slate-900/10 hover:bg-slate-900/20 p-2 rounded-full transition-colors" title="‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏¥‡∏ß"><Search size={18} /></button><button onClick={() => setView('admin-login')} className="bg-slate-900/10 hover:bg-slate-900/20 p-2 rounded-full transition-colors"><Lock size={18} /></button></div>
                            </div>
                        </div>
                        {shopStatus === 'CLOSED' && <div className="absolute inset-0 z-50 bg-slate-900/90 flex flex-col items-center justify-center p-8 text-center backdrop-blur-sm animate-in"><div className="bg-slate-800 p-8 rounded-2xl border border-red-500/30 shadow-2xl max-w-xs w-full"><Power size={48} className="text-red-500 mx-auto mb-4"/><h2 className="text-2xl font-bold text-white mb-2">‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏Ñ‡∏¥‡∏ß</h2><button onClick={() => setView('check-status')} className="w-full bg-slate-700 py-2 rounded-lg text-sm hover:bg-slate-600 transition-colors">‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏¥‡∏ß</button></div></div>}
                        <div className="flex-1 overflow-y-auto pb-8 relative">
                            {loadingData && <div className="absolute top-0 left-0 w-full h-1 bg-yellow-500/20 overflow-hidden z-10"><div className="w-full h-full bg-yellow-500 animate-progress origin-left" style={{animation: 'progress 1s infinite linear'}}></div></div>}
                            {status === 'success' ? (
                               <div className="flex flex-col items-center justify-center h-full text-center py-10 animate-in px-6"><div className="w-20 h-20 bg-green-500/20 rounded-full flex items-center justify-center mb-4 text-green-500"><CheckCircle size={48} /></div><h2 className="text-2xl font-bold text-white mb-2">‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h2><p className="text-slate-400 mb-6">{formData.date} {formData.time}</p><div className="flex gap-3"><button onClick={() => setStatus('idle')} className="bg-slate-700 hover:bg-slate-600 text-white py-2 px-6 rounded-full transition-colors">‡∏à‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°</button></div></div>
                            ) : (
                                <div className="p-6 space-y-8 animate-in">
                                    <section><h2 className="text-yellow-500 font-bold mb-4 text-sm flex items-center gap-2">üî• ‡∏ó‡∏£‡∏á‡∏ú‡∏°‡∏¢‡∏≠‡∏î‡∏Æ‡∏¥‡∏ï</h2><div className="flex gap-3 overflow-x-auto pb-4 snap-x">{hairstyles.map((style) => (<div key={style.id} onClick={() => setFormData(p=>({...p, selectedStyle: style, service: `‡∏ó‡∏£‡∏á ${style.name}`}))} className={`snap-center shrink-0 w-32 relative group cursor-pointer rounded-xl overflow-hidden border-2 transition-all ${formData.selectedStyle?.id === style.id ? 'border-yellow-500 scale-95' : 'border-transparent'}`}><img src={getDisplayImageUrl(style.image)} className="w-full h-40 object-cover" referrerPolicy="no-referrer" onError={(e)=>{e.target.style.display='none'; e.target.nextSibling.style.display='flex';}} /><div className="absolute inset-0 bg-slate-800 flex items-center justify-center hidden"><ImageIcon size={24}/></div><div className="absolute bottom-0 left-0 w-full bg-black/60 p-2"><p className="text-[10px] text-white truncate">{style.name}</p></div></div>))}</div></section>

                                    {/* NEW: ‡∏Ñ‡∏•‡∏±‡∏á‡∏£‡∏π‡∏õ‡∏ó‡∏£‡∏á‡∏ú‡∏°‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô */}
                                    {hairstyleImages.length > 0 && (
                                        <section className="bg-slate-800/50 p-4 rounded-xl border border-slate-700">
                                            <h2 className="text-yellow-500 font-bold mb-4 text-sm flex items-center gap-2">
                                                <ImageIcon size={16}/> ‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡πà‡∏ó‡∏£‡∏á‡∏ú‡∏° ({hairstyleImages.length})
                                            </h2>
                                            <div className="grid grid-cols-3 gap-2">
                                                {hairstyleImages.slice(0, 6).map((img) => (
                                                    <div key={img.id} className="aspect-square rounded-lg overflow-hidden border border-slate-700 bg-black cursor-pointer hover:border-yellow-500 transition-colors group relative" onClick={() => window.open(img.url, '_blank')}>
                                                        <img src={img.thumbnailUrl} alt={img.name} className="w-full h-full object-cover" loading="lazy"/>
                                                        <div className="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-white"><path d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/><path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7Z"/></svg>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                            {hairstyleImages.length > 6 && (
                                                <p className="text-center text-xs text-slate-500 mt-2">‡πÅ‡∏•‡∏∞‡∏≠‡∏µ‡∏Å {hairstyleImages.length - 6} ‡∏£‡∏π‡∏õ</p>
                                            )}
                                        </section>
                                    )}
                                    <form onSubmit={handleSubmit} className="space-y-4">
                                        <div className="space-y-1"><label className="text-xs text-slate-400">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label><input required type="text" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} className="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white focus:border-yellow-500 outline-none transition-colors" /></div>
                                        <div className="space-y-1"><label className="text-xs text-slate-400">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label><input required type="tel" value={formData.phone} onChange={e => setFormData({...formData, phone: e.target.value})} className="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white focus:border-yellow-500 outline-none transition-colors" /></div>
                                        <div className="grid grid-cols-2 gap-2">
                                            <div className="space-y-1"><label className="text-xs text-slate-400">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input required type="date" value={formData.date} onChange={e => setFormData({...formData, date: e.target.value})} className="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white focus:border-yellow-500 outline-none [color-scheme:dark] transition-colors" /></div>
                                            <div className="space-y-1"><label className="text-xs text-slate-400">‡∏ä‡πà‡∏≤‡∏á</label><select value={formData.barber} onChange={e => setFormData({...formData, barber: e.target.value})} className="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white focus:border-yellow-500 outline-none transition-colors">{["‡∏ä‡πà‡∏≤‡∏á‡∏ó‡πà‡∏≤‡∏ô‡πÑ‡∏´‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ", ...ALL_BARBERS].map(b => <option key={b} value={b}>{b}</option>)}</select></div>
                                        </div>
                                        <div className="space-y-2"><label className="text-xs text-slate-400">‡πÄ‡∏ß‡∏•‡∏≤</label><div className="grid grid-cols-4 gap-2">{TIME_SLOTS.map(t => { const busy = isSlotBusy(t); const selected = formData.time === t; return (<button key={t} type="button" disabled={busy} onClick={() => setFormData({...formData, time: t})} className={`py-2 rounded-lg text-xs font-bold transition-all relative ${busy ? 'bg-slate-800 text-slate-600 cursor-not-allowed border border-slate-800' : selected ? 'bg-yellow-500 text-slate-900 border border-yellow-500' : 'bg-slate-900 text-slate-300 border border-slate-700 hover:border-yellow-500'}`}>{t}{busy && <div className="absolute inset-0 flex items-center justify-center text-slate-500"><X size={16} className="opacity-50"/></div>}</button>) })}</div></div>
                                        {status === 'error' && <div className="text-red-400 text-sm bg-red-500/10 p-2 rounded flex gap-2 animate-in"><AlertCircle size={16}/> {message}</div>}
                                        <button type="submit" disabled={status === 'loading' || shopStatus === 'CLOSED'} className={`w-full font-bold py-3.5 px-4 rounded-lg shadow-lg transition-all flex items-center justify-center gap-2 active:scale-[0.98] mt-2 ${shopStatus === 'CLOSED' ? 'bg-slate-600 text-slate-400 cursor-not-allowed' : 'bg-yellow-500 hover:bg-yellow-400 text-slate-900 shadow-yellow-500/20'}`}>{status === 'loading' ? <Loader2 className="animate-spin"/> : shopStatus === 'CLOSED' ? '‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏Ñ‡∏¥‡∏ß' : '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô'}</button>
                                    </form>
                                    
                                    {/* Live Queue Status */}
                                    {formData.date && <LiveQueueStatus selectedDate={formData.date} busySlots={busySlots} />}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<BarberBookingApp />);
    </script>
</body>
</html>
